//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//
//                                                                                                      //
//                                     ğ——ğ—”ğ—©ğ—˜-ğ— ğ——-ğ—©ğŸ­  ğğğ“                                                  //
//                                                                                                      //
//                                          ï¼¶ï¼š1.0                                                      //
//                                                                                                      //
//               â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—      â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—                  //
//                â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘                  //
//                â•šâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘                  //
//                â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â•â•â•â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•šâ•â•â•â•â–ˆâ–ˆâ•‘                  //
//               â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘       â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•      â–ˆâ–ˆâ•‘                  //
//                â•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•        â•šâ•â•â•â•       â•šâ•â•                  //
//                                                                                                      //
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//

//*
//  * @project_name : Dave-Md-V1
//  * @author : gifteddaves
//  * @github : https://github.com/gifteddaves
//  * @whatsapp : https://wa.me/254104260236
//  * @telegram : https://t.me/Digladoo
//  * @instagram : https://www.instagram.com/_gifted_dave/profilecard/?igsh=MWFjZHdmcm4zMGkzNw==
//  * @description : Multi-functional WhatsApp User Bot based on Baileys & XLICON logic.
//*

require('../settings');
const chalk = require('chalk');
const { getContentType } = require('@whiskeysockets/baileys');

// Handle group metadata events
async function GroupUpdate(conn, update) {
  console.log(chalk.yellow('[GROUP UPDATE]:'), update);
}

// Handle group participant changes
async function GroupParticipantsUpdate(conn, update) {
  console.log(chalk.blueBright('[PARTICIPANT UPDATE]:'), update);
}

// Message handling logic
async function MessagesUpsert(conn, m, store) {
  try {
    if (!m.type || m.type !== 'notify') return;
    for (const msg of m.messages) {
      if (!msg.message || (msg.key && msg.key.remoteJid === 'status@broadcast')) continue;

      const contentType = getContentType(msg.message);
      const message = msg.message[contentType];
      const from = msg.key.remoteJid;
      const isGroup = from.endsWith('@g.us');
      const sender = isGroup ? msg.key.participant : msg.key.remoteJid;

      console.log(chalk.green('[MESSAGE RECEIVED]:'), from, contentType);

      if (contentType === 'conversation' || contentType === 'extendedTextMessage') {
        const text = contentType === 'conversation' ? message : message.text;
        const prefix = '.';
        const cmd = text.trim().toLowerCase();

        if (cmd === 'ping' || cmd === `${prefix}ping`) {
          const start = Date.now();
          const end = Date.now();
          await conn.sendMessage(from, {
            text: `ğŸ“ Pong â€¢ ${end - start}ms\nğŸ§  Dave-Md-V1`,
          }, { quoted: msg });
        }

        // Submenus
        if (cmd === `${prefix}ownermenu`) {
          await conn.sendMessage(from, { text: global.ownermenu(prefix) }, { quoted: msg });
        }
        if (cmd === `${prefix}groupmenu`) {
          await conn.sendMessage(from, { text: global.groupmenu(prefix) }, { quoted: msg });
        }
        if (cmd === `${prefix}downloadmenu`) {
          await conn.sendMessage(from, { text: global.downloadmenu(prefix) }, { quoted: msg });
        }
        if (cmd === `${prefix}animemenu`) {
          await conn.sendMessage(from, { text: global.animemenu(prefix) }, { quoted: msg });
        }
        if (cmd === `${prefix}othermenu`) {
          await conn.sendMessage(from, { text: global.othermenu(prefix) }, { quoted: msg });
        }
      }
    }
  } catch (err) {
    console.error(chalk.red('[ERROR IN MESSAGE HANDLER]'), err);
  }
}

// Startup logic
async function Solving(conn, store) {
  console.log(chalk.green('[DAVE-MD] Bot started and monitoring messages...'));
}

// Export all
module.exports = {
  GroupUpdate,
  GroupParticipantsUpdate,
  MessagesUpsert,
  Solving
};

//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//
// ğŸŒŸ SUBMENU TEMPLATES â€” Dave-Md-V1
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//
global.ownermenu = (prefix) => `
â”â”â”â– á´á´¡É´á´‡Ê€ á´á´‡É´á´œ â–â”â”â”“
â”ƒâ¿» ${prefix}setppbot
â”ƒâ¿» ${prefix}setprefix
â”ƒâ¿» ${prefix}shutdown
â”ƒâ¿» ${prefix}bc
â”ƒâ¿» ${prefix}join
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›`;

global.groupmenu = (prefix) => `
â”â”â”â– É¢Ê€á´á´œá´˜ á´á´‡É´á´œ â–â”â”â”“
â”ƒâ¿» ${prefix}add
â”ƒâ¿» ${prefix}kick
â”ƒâ¿» ${prefix}promote
â”ƒâ¿» ${prefix}demote
â”ƒâ¿» ${prefix}setname
â”ƒâ¿» ${prefix}setdesc
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›`;

global.downloadmenu = (prefix) => `
â”â”â”â– á´…á´á´¡É´ÊŸá´á´€á´… á´á´‡É´á´œ â–â”â”â”“
â”ƒâ¿» ${prefix}ytmp3
â”ƒâ¿» ${prefix}ytmp4
â”ƒâ¿» ${prefix}tiktok
â”ƒâ¿» ${prefix}instagram
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›`;

global.animemenu = (prefix) => `
â”â”â”â– á´€É´Éªá´á´‡ á´á´‡É´á´œ â–â”â”â”“
â”ƒâ¿» ${prefix}anime
â”ƒâ¿» ${prefix}manga
â”ƒâ¿» ${prefix}neko
â”ƒâ¿» ${prefix}waifu
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›`;

global.othermenu = (prefix) => `
â”â”â”â– á´á´›Êœá´‡Ê€ á´á´‡É´á´œ â–â”â”â”“
â”ƒâ¿» ${prefix}ping
â”ƒâ¿» ${prefix}owner
â”ƒâ¿» ${prefix}report
â”ƒâ¿» ${prefix}runtime
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›`;
